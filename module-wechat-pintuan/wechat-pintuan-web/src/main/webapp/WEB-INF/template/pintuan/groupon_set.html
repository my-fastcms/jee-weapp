#include ("/_includes/_layout.html")
#@layout("多人拼团", "wxmall,点步科技", "Wxmall社区","wxmall") 
<link href="#(webctx)/resources/css/pintuan.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="#(webctx)/resources/css/product.css"/>
<style>
.radioBox{
	position: relative;
	top: 3px;
	width: 15px;
	height: 15px
}
.lableTip{
	color: #bbb!important;
	font-weight: 400;
	display: inline-block;
    max-width: 100%;
    font-size: 12px;
}
h3{
	background-color: #f5f5f5;
    font-size: 14px;
    font-weight: 700;
    padding: 10px;
}
.app-image-list li{
    height: 60px;
    width: 60px;
}
</style>
#define content()
<div class="flex-column-container h-full m-h-full r-3x box-shadow-2 bg-white wrapper-sm p-t-none pos-rlt">
	<aside class="flex-container pos-rlt overflow-y-visible ng-scope" ng-if="!baseLoading">
		<div group-common="" is-disabled="!isShowEdit" class="ng-isolate-scope">
			<div class="group-common-contain">
				<div ng-transclude="">
					<form id="cashbackForm" class="form-horizontal">
						<input type="hidden" name="id" id="id" value="#(groupResult.multiGroup.id??)"/>
<!-- ============ 基本信息模块 =================-->	
						<div class="r-3x wrapper-md p-b-none m-b-sm clearfix ng-scope">
							<input type="hidden" name="id" id="id" value="#(groupResult.multiGroup.id??)"/>
							<h3 class="m-t-none m-b-md text-lg font-bold">基本信息</h3>
							<div class="form-group">
					            <label class="col-md-2 control-label">活动名称&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-md-8" id="error_name">
					                <input id="name" name= "name" value="#(groupResult.multiGroup.name??)" maxlength="20" type="text" class="form-control" style="width: 400px;"/>
					                <label class="control-label" for="name"></label>
					            </div>
				      		</div>
					        <div class="form-group">
					            <label class="col-md-2 control-label">活动时间&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-sm-10 col-md-10">
				                   	<div class="row">
				                   		<div class="col-lg-2 col-md-2" id="error_start_time">
					                        <input type="text" id="start_date" name="start_date" readonly="readonly" style="width: 160px;"
											onfocus="WdatePicker({errDealMode:2, skin:'twoer', isShowClear:false,readOnly:true,dateFmt:'yyyy-MM-dd %H:%m:%s',minDate:'%y-%M-%d %H:%m:%s',maxDate:'#F{$dp.$D(\'end_date\')}'})"
											class="Wdate" value="#(groupResult.multiGroup.start_date??)" />
											<label class="control-label" for="start_date"></label>
					                    </div>
					                    <div class="col-lg-2 col-md-2" id="error_end_time">
					                        <input type="text" id="end_date" name="end_date" readonly="readonly" style="width: 160px;"
											onfocus="WdatePicker({errDealMode:2, skin:'twoer', isShowClear:false,readOnly:true,dateFmt:'yyyy-MM-dd %H:%m:%s',minDate:'#F{$dp.$D(\'start_date\',{d:7});}'})"
											class="Wdate" value="#(groupResult.multiGroup.end_date??)" />	
											<label class="control-label" for="end_date"></label>
					                    </div>	
					                    <div class="col-lg-3 col-md-3" style="padding-top: 6px;">
					                    	<a class="label label-default" href="javascript:dateTimeTag(7);">一周</a>
					                    	<a class="label label-default" href="javascript:dateTimeTag(15);">半个月</a>
					                    	<a class="label label-default" href="javascript:dateTimeTag(30);">一个月</a>
					                    </div> 
					                </div>
					            </div>
				        	</div>
				        	<div class="form-group">
					            <label class="col-md-2 control-label">活动类型&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-sm-10 col-md-10" style="padding-top: 2px;">
					               	<input class="radioBox input-disable" id="multi_type_0" #if(!groupResult.multiGroup.multi_type?? || groupResult.multiGroup.multi_type == 0) checked="checked" #end name= "multi_type" value="0" type="radio">
					               	<label for="multi_type_0">&nbsp;普通团&nbsp;&nbsp;&nbsp;&nbsp;</label>
					               	<input class="radioBox input-disable" id="multi_type_1" #if(groupResult.multiGroup.multi_type?? && groupResult.multiGroup.multi_type == 1) checked="checked" #end name= "multi_type" value="1" type="radio">
					               	<label for="multi_type_1">&nbsp;单团抽奖</label>
					               	<i class="fa fa-question-circle" onmouseout="layer.closeAll();" onmouseover="layer.tips('拼团成功后，在团内进行抽奖', this, {tips: [1, '#3595CC'],time: 0});"></i>&nbsp;&nbsp;&nbsp;&nbsp;
					               <!-- 	<input class="radioBox input-disable" id="multi_type_2" name= "multi_type" #if(groupResult.multiGroup.multi_type?? && groupResult.multiGroup.multi_type == 2) checked="checked" #end value="2" type="radio">
					               	<label for="multi_type_2">&nbsp;活动抽奖</label>
					               	<i class="fa fa-question-circle" onmouseout="layer.closeAll();" onmouseover="layer.tips('活动结束后，在所有拼团成功的团员中抽奖', this, {tips: [1, '#3595CC'],time: 0});"></i>&nbsp;&nbsp;&nbsp;&nbsp;-->
					               	</div>
				      		</div>
						</div>
<!-- ============ 优惠规则模块 =================-->
						<div class="r-3x wrapper-md p-b-none m-b-sm clearfix ng-scope">
							<h3 class="m-t-none m-b-md text-lg font-bold">优惠规则</h3>
				        	<div class="form-group">
					            <label class="col-md-2 control-label">参团用户条件&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-sm-10 col-md-10" style="padding-top: 2px;">
					               	<input class="radioBox input-disable" #if(!groupResult.multiGroup.group_condition?? || groupResult.multiGroup.group_condition == 0) checked="checked" #end id="group_condition_0" name= "group_condition" value="0" type="radio">
					               	<label for="group_condition_0">&nbsp;不限制&nbsp;&nbsp;&nbsp;&nbsp;</label>
					               	<input class="radioBox input-disable" id="group_condition_1" #if(groupResult.multiGroup.group_condition?? && groupResult.multiGroup.group_condition == 1) checked="checked" #end name= "group_condition" value="1" type="radio">
					               	<label for="group_condition_1">&nbsp;新用户</label>
					               	<label style="float:right:" class="control-label lableTip">&nbsp;&nbsp;&nbsp;&nbsp;只限制参团用户，开团用户不受影响；新用户指在店铺未下过单的用户</label>
					            </div>
				      		</div>
				        	<div class="form-group">
					            <label class="col-md-2 control-label">强制关注&nbsp;<span><em>&nbsp;&nbsp;</em></span></label>
					            <div class="col-sm-10 col-md-10" style="padding-top: 2px;">
					               	<input class="radioBox" id="need_follows" name= "need_follows" #if(groupResult.multiGroup.need_follows?? && groupResult.multiGroup.need_follows) checked="checked" #end  type="checkbox">
					               	<label for="needFollows">&nbsp;开启&nbsp;&nbsp;&nbsp;&nbsp;</label>
					               	<label style="float:right:;color:#FFA500!important" class="control-label fa fa-warning lableTip">&nbsp;&nbsp;&nbsp;&nbsp;因微信政策原因，选择此选项有封号危险</label>
					               	<label style="float:right:" class="control-label lableTip">&nbsp;&nbsp;&nbsp;&nbsp;开启后，用户需关注公众号才可开团或参团，会在开团及参团时提示</label>
					            </div>
				      		</div>
				      		<div class="hide" id="followsText">
					      		<div class="form-group" >
						            <label class="col-md-2 control-label">关注回复图文标题&nbsp;<span style="color: red;"><em>*</em></span></label>
						            <div class="col-md-8" id="error_follows_title">
						                <input id="follows_title" name= "follows_title" value="#(groupResult.multiGroup.follows_title??)" maxlength="50" type="text" class="form-control" style="width: 400px;display: inline;float: left;"/>
						                &nbsp;&nbsp;&nbsp;&nbsp;
						                <label class="control-label" for="follows_title"></label>
						                <span style="float:right:" class="control-label lableTip">最多50字</span>
						            </div>
					      		</div>
					      		<div class="form-group">
					           		<label class="control-label col-md-2">关注回复图文封面&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
						            <div class="col-md-8">
							        	<input id="follows_image" name="follows_image"  #if(groupResult.multiGroup.follows_image??) value="#(groupResult.multiGroup.follows_image??)"#end type="hidden">
									    <div id="follows_image-div" class="main-image-div"  style="width: 100px;height: 100px"> 
								     	#if(groupResult.multiGroup.follows_image??)
			                              <img class="image-preview" src="#(groupResult.multiGroup.follows_image??)" >
				                          <a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage('follows');">×</a>
			                            #else
						                  <a class="main-image-add" style="width: 100px;margin: 8px 0px;" onclick="addNewsImage('follows');" href="javascript:;">+加图</a>
							             #end
							            </div>
							            <a style="position: relative;top: 35px;" class="btn btn-default btn-sm" href="#(webctx)/groupon/download?url=/resources/img/pintuan_share.jpg">下载默认图</a>
							            <br><span class="control-label lableTip">建议尺寸 500*500</span>   
							         </div>
						        </div>
						        <div class="form-group">
						            <label class="col-md-2 control-label">关注回复图文简介&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
						            <div class="col-md-8" id="error_follows_intro">
						                <textarea id="follows_intro" name= "follows_intro" maxlength="100" class="form-control" style="width: 400px;height:120px;">#(groupResult.multiGroup.follows_intro??)</textarea>
						                <label class="control-label" for="follows_intro"></label>
						                <span class="control-label lableTip">最多100字</span>
						            </div>
					      		</div>
				      		</div>
				      		<div class="form-group" style="display: none">
					            <label class="col-md-2 control-label">模拟成团&nbsp;<span><em>&nbsp;&nbsp;</em></span></label>
					            <div class="col-sm-10 col-md-10" style="padding-top: 2px;">
					               	<input class="radioBox" id="enable_moni_suc" name= "enable_moni_suc" #if(groupResult.multiGroup.enable_moni_suc?? && groupResult.multiGroup.enable_moni_suc) checked="checked" #end type="checkbox">
					               	<label for="enable_moni_suc">&nbsp;开启&nbsp;&nbsp;&nbsp;&nbsp;</label>
									<i class="fa fa-question-circle" onmouseout="layer.closeAll();" onmouseover="layer.tips('开启模拟成团后，成团有效时间内人数未满的团，系统将会模拟“匿名买家”凑满人数，使该团成团，不再触发自动退款。', this, {tips: [1, '#3595CC'],time: 0});"></i>
					            </div>
				      		</div>
					      	<div class="form-group">
					        	<label class="col-md-2 control-label">参团人数&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-md-10" id="error_offer_num">
									<div class="input-group" style="width: 150px;float: left;">
									<input  type="text" value="#(groupResult.multiGroup.offer_num??)" id="offer_num" name="offer_num" class="form-control" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')">
									<span class="input-group-addon">位</span>
									</div>&nbsp;&nbsp;
									<label class="control-label" for="offer_num"></label>
									 <span style="float:right:" class="control-label lableTip">建议参团人数不少于3人</span>
					            </div>
					        </div> 
				      		<div class="form-group">
					            <label class="col-md-2 control-label">成团有效时间&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-md-10" id="error_valid_time">
									<div class="input-group" style="width: 150px;float: left;">
										<input  type="text" value="#(groupResult.multiGroup.valid_time??)" id="valid_time" name="valid_time" class="form-control" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')">
										<span class="input-group-addon">小时</span>
									</div>&nbsp;&nbsp;
									<label class="control-label" for="valid_time"></label>
									<span style="float:right:" class="control-label lableTip">不超过2000小时</span>
					            </div>
				      		</div>
					      	<div class="form-group">
					        	<label class="col-md-2 control-label">商品限购&nbsp;&nbsp;<span><em>&nbsp;&nbsp;</em></span></label>
					            <div class="col-md-3">
						            <label>
										<div class="input-group" style="width: 150px;float: left;">
										<input style="font: -webkit-control;" type="text" value="#(groupResult.multiGroup.quota??)" id="quota" name="quota" class="form-control" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')">
										<span class="input-group-addon">件/人</span>
										</div>
									</label>
					            </div>
					        </div>
						</div>
<!-- ============ 活动宣传模块 =================-->						
						<div class="r-3x wrapper-md p-b-none m-b-sm clearfix ng-scope">
							<h3 class="m-t-none m-b-md text-lg font-bold">活动宣传</h3>
					        <div class="form-group">
				           		<label class="control-label col-md-2">活动图片&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
					            <div class="col-md-8" id="error_activity_image">
						        	<input id="activity_image" name="activity_image" #if(groupResult.multiGroup.activity_image??) value="#(groupResult.multiGroup.activity_image??)"#end type="hidden">
								    <div id="activity_image-div" class="main-image-div"  style="width: 140px;"> 
							     	#if(groupResult.multiGroup.activity_image??)
		                              <img class="image-preview" src="#(groupResult.multiGroup.activity_image??)" >
			                          <a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage('activity');">×</a>
		                            #else
					                 <a class="main-image-add" style="width: 140px;" onclick="addNewsImage('activity');" href="javascript:;">+加图</a>
						             #end
						            </div>
						            <a style="position: relative;top: 23px;" class="btn btn-default btn-sm" href="#(webctx)/groupon/download?url=/resources/img/pintuan_activity.png">下载默认图</a>
						            <br><label class="control-label lableTip">在活动首页顶部展示， 图片尺寸：750 * 420p像素</label>   
						         </div>
					        </div>
					        <div class="form-group">
					            <label class="col-md-2 control-label">活动说明&nbsp;&nbsp;&nbsp;&nbsp;</label>
					            <div class="col-md-8">
					                <textarea rows="5" id="activity_explain" style="width: 300px;height:120px;resize: vertical;" name= "activity_explain" maxlength="200" class="form-control">#(groupResult.multiGroup.activity_explain??)</textarea>
					                <label class="control-label lableTip">最多200字</label>
					            </div>
				      		</div>
					        <div class="form-group">
					            <label class="col-md-2 control-label">分享设置&nbsp;&nbsp;<span style="color: red;"><em>*</em></span></label>
								<div class="col-md-8">
									<div class="r-3x bg-white m-b-sm">
										<h5 class="padder-md b-b-e text-base font-bold m-t-none m-b-md" style="line-height: 36px;">拼团活动专题页</h5>
										<div class="padder-md clearfix">
											<div class="pull-left m-r-md">
												<div class="clearfix m-b-md">
													<label class="control-label must pull-left m-r-sm w-60 pos-rlt text-left">分享标题&nbsp;<span style="color: red;"><em>*</em></span></label>
													<div class="col-md-8" id="error_share_title">
														<input id="share_title" name= "share_title" value="#(groupResult.multiGroup.share_title??)" maxlength="30" type="text" class="form-control" style="width: 300px;" placeholder="最多30字"/>
														<label class="control-label" for="share_title"></label>
													</div>
												</div>
												<div class="clearfix m-b-md">
													<label class="control-label must pull-left m-r-sm w-60 pos-rlt text-left">分享简介&nbsp;<span style="color: red;"><em>*</em></span></label>
													<div class="col-md-8" id="error_share_intro">
														<textarea id="share_intro" name= "share_intro" maxlength="50" class="form-control" style="width: 300px;height:120px;" placeholder="最多50字">#(groupResult.multiGroup.share_intro??)</textarea>
														<label class="control-label" for="share_intro"></label>
														<span class="control-label lableTip">分享到朋友圈时，只显示分享标题</span> 
													</div>
												</div>
											</div>
											<div class="pull-left">
												<div class="m-r-sm pull-left">
										        	<input id="share_image" name="share_image" #if(groupResult.multiGroup.share_image??) value="#(groupResult.multiGroup.share_image??)"#end type="hidden">
												    <div id="share_image-div" class="main-image-div"  style="width: 100px;height: 100px;border-radius:5px;"> 
											     	#if(groupResult.multiGroup.share_image??)
						                              <img class="image-preview" src="#(groupResult.multiGroup.share_image??)" >
							                          <a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage();">×</a>
						                            #else
						                             <a class="main-image-add" style="width: 100px;margin: 8px 0px;" onclick="addNewsImage();" href="javascript:;">+加图</a>
										            #end
										            </div>
										            <a style="position: relative;top: 34px;" class="btn btn-default btn-sm" href="#(webctx)/groupon/download?url=/resources/img/pintuan_share.jpg">下载默认图</a>
												</div>
											</div>
										</div>
									</div>
									<div class="r-3x bg-white m-b-none">
										<h5 class="padder-md b-b-e text-base font-bold m-t-none m-b-md" style="line-height: 36px;">拼团详情页</h5>
										<div class="padder-md clearfix">
											<div class="pull-left m-r-md">
												<div class="clearfix m-b-md">
													<label class="control-label must pull-left m-r-sm w-60 pos-rlt text-left">分享标题&nbsp;<span style="color: red;"><em>*</em></span></label>
													<div class="col-md-8" id="error_detail_title">
														<input id="detail_title" name= "detail_title" value="#(groupResult.multiGroup.detail_title??)" maxlength="30" type="text" class="form-control" style="width: 300px;" placeholder="最多30字"/>
														<label class="control-label" for="detail_title"></label>
													</div>
												</div>
												<div class="clearfix m-b-md">
													<label class="control-label must pull-left m-r-sm w-60 pos-rlt text-left">分享简介&nbsp;<span style="color: red;"><em>*</em></span></label>
													<div class="col-md-8" id="error_detail_intro">
														<textarea id="detail_intro" name= "detail_intro" maxlength="50" class="form-control" style="width: 300px;height:120px;" placeholder="最多50字">#(groupResult.multiGroup.detail_intro??)</textarea>
														<label class="control-label" for="detail_intro"></label>
														<span class="control-label lableTip">分享到朋友圈时，只显示分享标题</span> 
													</div>
												</div>
											</div>
											<div class="pull-left">
												<div class="m-r-sm pull-left" tyle="position:relative;width:100px;height:100px;">
												    <div id="news-image-div" class="main-image-div"  style="width: 100px;height: 100px;border-radius:5px;"> 
												    	<img class="image-preview" src="#(webctx)/resources/img/defaultPic.png" >
														<div class="pos-abt-a" style="position:absolute;left:7px;top:40px;">默认商品图片</div>
										            </div><br>
												</div>
											</div>
										</div>
									</div>
								</div>
				      		</div>
	
						</div>
<!-- ==============商品选择开始 ==================-->				
						<div class="tabs-container">
					        <ul id="select_item_tab" class="nav nav-tabs">
					            <li style="width: 180px;" #if(groupResult==null) class="active" #end><a id="select_item_a" href="javascript:void(0)">第一步:选择商品</a></li>
					            <li style="width: 180px;" #if(groupResult!=null) class="active" #end><a id="set_promotion_a" href="javascript:void(0)">第二步:设置团购价<font color="red" id="_sel_total_item" style="display: none;"></font></a></li>
					        </ul>
					     </div>
					    <div class="panel-body">
							<div id="myTabContent" class="tab-content">
								<div class="tab-pane #if(groupResult==null) active #end" id="select_items_div">
									<table class="table table-striped table-bordered bootstrap-datatable datatable" id="mainTable" border="0" style="width: 100%">
										<thead>
											<tr>
												<th><input type="checkbox" id="all" title="全选/反选" style="margin-right: 4px; vertical-align: middle;"/></th>
												<th><span style="vertical-align: middle;">&nbsp;&nbsp;商品</span></th>
												<th>价格</th>
												<th>库存</th>
											</tr>
										</thead>
										<tbody class="productLotGrid"></tbody>
									</table>
									<div id="productToolsbar" class="panel-body">
										<div id="pager" class="jqpager" style="margin-bottom: 1px;float: right;"></div>
									</div>
								</div>
								<div class="tab-pane #if(groupResult !=null) active #end" id="groupon_set_div">
								    <div style="float: left; padding-right: 20px;padding-bottom: 10px;">
										<a onclick="batchPrice()" class="btn btn-primary btn-xs" href="javascript:void(0)">批量设置拼团价</a>
									</div>
									<div id="batch-dazhe" style="display: none;">
										<input id="bc-price" type="text" value="" placeholder="请输入价格" style="width: 80px;" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')"/>
										<a onclick="confirmPrice()" href="javascript:void(0)">确定</a>&nbsp;&nbsp;<a id="quxiao_dazhe_a" href="javascript:void(0)">取消</a>
									</div>
									<table class="table table-striped table-bordered bootstrap-datatable datatable" id="promotionSetTable" border="0" style="width: 100%;font-size: 12px;">
											<tbody class="productSetLotGrid">
											#if(groupResult.productDto?? !=null)
											#for(product : groupResult.productDto)
											   	<tr class="package trcls_#(product.id)" pp="#(product.price)" prodId="#(product.id)" ptype="">
													<td>
														<div class="js-picture-lists app-image-list" style="display: inline-flex;">
														<img src="#(product.img)" width="50px" height="50px">&nbsp;&nbsp;
														<div>
														<p class="goods-title"><font color="red">￥#(product.price)</font></p>
														<p class="goods-title">#(product.name)</p>
														</div>
														</div>
													</td>
													<td>
														<div id="createTable_#(product.id)" data-title="#(product.arrayTitle)" data-arrayInfor="#(product.arrayInfor)"></div>
													</td>
													<td><a id="#(product.id)" href="javascript:void(0)">取消</a></td>
												</tr>
											#end
											#end
											</tbody>
									</table>
								</div>
					      </div>
					   </div> 
 <!-- ==============商品选择结束 ==================-->
					</form>
				</div>
			</div>
		</div>
	</aside>
	<div class="modal-footer" >
	  	<div class="panel-footer" align="center">
	   	 	<button type="button" onclick="saveGroupon();" class="btn btn-sm btn-success"><i class="fa fa-dot-circle-o"></i>提交</button>
	   	 	<a href="#(webctx)/groupon" class="btn btn-default btn-sm">取   消</a>
		</div>	
    </div>
</div>
<!-- 选择的商品列表模板 -->
<script type="text/template" id="product_table_tr_tpl">
		<tr class="package">
			<td><input type="checkbox" class="commchk" id="checkbox_{id}" product_info="{arrayInfor}" product_title="{arrayTitle}" product_infoId="{arrayInforId}" product_spec="{arraySpec}" product_id="{id}" product_name="{name}" product_price="{price}" product_stock="{stock}" product_img="{img}" style="margin-right: 4px; vertical-align: middle;"/></td>
			<td>
			<div class="js-picture-lists app-image-list"><img src="{img}" width="40px" height="40px">&nbsp;&nbsp;
            <p class="goods-title" style="display: inline;"><a class="new-window" href="javascript:void(0)" title="{name}">{name}</a></p>
			</div>
			</td>
			<td><span class="label label-success">￥{price}</span></td>
            <td>{stock}</td>
		</tr>
</script>
<script type="text/template" id="promotion_set_tr_tpl">
	<tr class="package trcls_{id}" pp="{price}" prodId="{id}" ptype="">
		<td>
			<div class="js-picture-lists app-image-list" style="display: inline-flex;">
			<img src="{img}" width="50px" height="50px">&nbsp;&nbsp;
			<div>
				<p class="goods-title"><font color="red">￥{price}</font></p>
				<p class="goods-title">{name}</p>
			</div>
			</div>
		</td>
		<td><div id="createTable_{id}"></div></td>
		<td><a id="{id}" href="javascript:void(0)">取消</a></td>
	</tr>	
</script>
<script type="text/javascript">

//图片操作========================================
function deleteNewsImage(flag){
	if(flag == "activity"){
		var h='<a class="main-image-add" style="width: 140px;" onclick="addNewsImage('+"'activity'"+');" href="javascript:;">+加图</a>';
		 $("#activity_image-div").empty().append(h);
		 $('#activity_image').val('');
	}else if(flag == "follows"){
		var h='<a class="main-image-add" style="width: 100px;margin: 8px 0px;;" onclick="addNewsImage('+"'follows'"+');" href="javascript:;">+加图</a>';
		 $("#follows_image-div").empty().append(h);
		 $('#follows_image').val('');
	}else{
		var h='<a class="main-image-add" style="width: 100px;margin: 8px 0px;" onclick="addNewsImage();" href="javascript:;">+加图</a>';
		 $("#share_image-div").empty().append(h);
		 $('#share_image').val('');
	}

}

//---图文消息封面
$(".main-image-div").hover(function(){
	$(this).find(".close-modal").removeClass("hide");
    $(this).find(".close-modal").addClass("hover");
},function(){
	 $(this).find(".close-modal").addClass("hide");  
	 $(this).find(".close-modal").removeClass("hover");
});

function addNewsImage(obj){
	obz.selectImageOne(function(selImgs){
		if(selImgs.length<=0){
			obz.error("请选择一张图片");
			return false;
		}
		var img = selImgs[0];
		if(obj == 'activity'){
			var h='<img class="image-preview" src="'+img.url+'" >';
	      	h=h+'<a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage('+"'activity'"+');">×</a>';
		    $("#activity_image-div").empty().append(h); 
		    $('#activity_image').val('#(img_domain)' +img.title);
			return true;
		}else if(obj == "follows"){
			var h='<img class="image-preview" src="'+img.url+'" >';
	      	h=h+'<a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage('+"'follows'"+');">×</a>';
		    $("#follows_image-div").empty().append(h); 
		    $('#follows_image').val('#(img_domain)' +img.title);
			return true;
		}else{
			var h='<img class="image-preview" src="'+img.url+'" >';
	      	h=h+'<a class="close-modal small hide" href="javascript:;" onclick="deleteNewsImage();">×</a>';
		    $("#share_image-div").empty().append(h); 
		    $('#share_image').val('#(img_domain)' +img.title);
		    return true;
		}
	});
}

//关注回复标题文本框===========================================
$(function(){
	$("#need_follows").click(function(){
		if($("#need_follows").prop("checked")){
			$("#followsText").removeClass("hide");
		}else{
			$("#followsText").addClass("hide");
		}
	});
	
	#if(groupResult.multiGroup??)
		$(".input-disable").each(function(){
			$(this).attr("disabled","disabled");
		});
		#if(groupResult.multiGroup.need_follows)
			$("#followsText").removeClass("hide");
		#end	
	#end	
})

var step ="";
var stepInfoNull="";
var items = new Array();
//取消批量打折
$("#quxiao_dazhe_a").click(function(){
	$("#bc-price").val("");
	$("#batch-dazhe").hide();
});
//批量打折
function confirmPrice(){
	var zhekou = $("#bc-price").val();
	$("input[name='collage_price']").val(zhekou);
}
function batchPrice(){
	$("#batch-dazhe").show();
	$("#batch-jianjia").hide();
}
//选中商品
function selectItem(obj){
	$("#_sel_total_item").html(parseInt(TBatch.getCheckedCount()) + parseInt($("#_sel_total_item").text()));
	var productId = $(obj).attr("product_id");
	//check
	var hasItem = false;
	$(".productSetLotGrid tr").each(function(){
		if($(this).attr("prodId") == productId){
			hasItem = true;
			$(this).attr("opt", "");
			$(this).show();
			return false;
		}
	});
	//如果设置列表中有了该商品就不再添加，
	//由于取消设置是隐藏该行，
	//并把该行数据的opt标志为“del”，
	//所以此处如果找到设置列表存在的话，就移除删除标志，并显示该行
	if(hasItem) {
		return;
	}
	var productName = $(obj).attr("product_name");
	var productImage = $(obj).attr("product_img");
	var productPrice = $(obj).attr("product_price");
	var productStock = $(obj).attr("product_stock");
	var product = {id:productId, name:productName, price:productPrice, img:productImage};
	var trHtml = obz.dataTemplate4obj($("#promotion_set_tr_tpl").html(), product);
	$(".productSetLotGrid").append(trHtml);
	var info = $(obj).attr("product_info");
	var infoId = $(obj).attr("product_infoId");
	var title = $(obj).attr("product_title");
	var productId=$(obj).attr("product_id");
	var productSpec= $(obj).attr("product_spec");
	if(info != null && info != ""){
		step.Creat_Table(info,infoId,title,productId,productSpec);	
	}else{
		stepInfoNull.Creat_Table(productPrice,productStock,productId);	
	}
	
	bindSetTableAEvent();
}

//取消选中
function unSelectItem(obj){
	$("#_sel_total_item").html(parseInt(TBatch.getCheckedCount()) + parseInt($("#_sel_total_item").text()));
	$(".productSetLotGrid").find("tr.trcls_"+$(obj).attr("product_id")).hide();
//==========$(obj).parent().parent().removeAttr("style");
}


$("#select_item_tab li").find("a").click(function(){
	$("#select_item_tab li").each(function(){
		$(this).removeClass("active");
	});
	$("#select_items_div").removeClass("active");
	$("#groupon_set_div").removeClass("active");
	var me = $(this);
	me.parent().addClass("active");
	if(me.attr("id")=="select_item_a"){
		//获取商品列表
		$("#select_items_div").addClass("active");
	}else {
		//展示设置列表
		$("#groupon_set_div").addClass("active");
	}
});

function num(obj){
	obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
}

/*===提交===*/
function saveGroupon(){
	var params = {}, error = {};
	var  name = $("#name").val(),start_date = $("#start_date").val(),
	end_date = $("#end_date").val(),id=$("#id").val(),offer_num=$("#offer_num").val(),
	quota=$("#quota").val(),re_union_num=$("re_union_num").val(),
	valid_time=$("#valid_time").val(),multi_type=$('input[name="multi_type"]:checked').val(),
	group_condition=$('input[name="group_condition"]:checked').val(),follows_title=$("#follows_title").val(),
	follows_image=$("#follows_image").val(),follows_intro=$("#follows_intro").val(),
	activity_image=$("#activity_image").val(),activity_explain=$("#activity_explain").val(),
	share_image=$("#share_image").val(),share_title=$("#share_title").val(),
	share_intro=$("#share_intro").val(),detail_title=$("#detail_title").val(),
	detail_intro=$("#detail_intro").val(),need_follows = $("input:checkbox[name='need_follows']").is(':checked');
	
	params.id=id;
	if($.trim(name) =="") {error.error_name = "活动名称不能为空"; } else {error.error_name=""; params.name = $.trim(name);}
	if($.trim(start_date) =="") {error.error_start_time = "开始时间不能为空"; } else {error.error_start_time =""; params.start_date = $.trim(start_date);}
	if($.trim(end_date) =="") {error.error_end_time = "结束时间不能为空"; } else { error.error_end_time=""; params.end_date = $.trim(end_date);}
	if($.trim(offer_num) =="" || $.trim(offer_num) < 2 ) {error.error_offer_num= "参团人数不能小于2"; } else { error.error_offer_num=""; params.offer_num = $.trim(offer_num);}
	if($.trim(valid_time) =="") {error.error_valid_time= "团有效时间不能为空"; } else { error.error_valid_time=""; params.valid_time = $.trim(valid_time);}
	if($.trim(need_follows) != "" && need_follows) {
		if($.trim(follows_title) =="") {error.error_follows_title= "关注回复标题不能为空"; } else { error.error_follows_title=""; params.follows_title = $.trim(follows_title);}
		if($.trim(follows_intro) =="") {error.error_follows_intro= "关注回复简介不能为空"; } else { error.error_follows_intro=""; params.follows_intro = $.trim(follows_intro);}
	} 
	if($.trim(share_title) =="") {error.error_share_title= "分享标题不能为空"; } else { error.error_share_title=""; params.share_title = $.trim(share_title);}
	if($.trim(share_intro) =="") {error.error_share_intro= "分享简介不能为空"; } else { error.error_share_intro=""; params.share_intro = $.trim(share_intro);}
	if($.trim(detail_title) =="") {error.error_detail_title= "分享标题不能为空"; } else { error.error_detail_title=""; params.detail_title = $.trim(detail_title);}
	if($.trim(detail_intro) =="") {error.error_detail_intro= "分享简介不能为空"; } else { error.error_detail_intro=""; params.detail_intro = $.trim(detail_intro);}
	
	params.group_condition = group_condition;
	params.multi_type = multi_type;
	params.group_condition = group_condition;
	params.activity_explain = activity_explain;
	params.follows_image = follows_image;
	params.activity_image = activity_image;
	params.share_image = share_image;
	params.need_follows = need_follows;
    params.quota= $.trim(quota);	
    params.re_union_num= $.trim(re_union_num);
    
  	params.enable_moni_suc = $("input:checkbox[name='enable_moni_suc']").is(':checked');
    
	var hasErr = false;
	for(var key in error){
		if(error[key]!=""){
			if(!hasErr) hasErr = true;
			$("#"+key).addClass("has-error");
			$("#"+key).find("label").text(error[key]);
		}else{
			$("#"+key).removeClass("has-error");
			$("#"+key).find("label").empty();
		}
	}
	//主表信息不完整，返回
	if(hasErr) return false;
	var productIds="";
	var specArray = new Array();
	$(".productSetLotGrid .package").each(function(){
		var productId = $(this).attr("prodid");
		var specitem=$(this).find("table").attr("specitem");
		var opt = $(this).attr("opt");
		productIds=productIds+productId+",";	
		if(specitem){
			var spec=JSON.parse(specitem);
			$(this).find("table tbody tr").each(function(index, item){
				var entity = new Object();
				entity.productId =productId;
				entity.specificationValue=spec[index];
				entity.msetId= $(this).find("input[name='groupSetId']").val(); 
				entity.prime_cost = $(this).find("input[name='prime_cost']").val();       //原价
				entity.collage_price = $(this).find("input[name='collage_price']").val(); //拼团价
				entity.opt=opt;
				specArray.push(entity);
			});
		}else{
			var entity = new Object();
			$(this).find("table tbody tr").each(function(index, item){
				entity.productId =productId;
				entity.specificationValue="";
				entity.msetId= $(this).find("input[name='groupSetId']").val(); 
				entity.prime_cost = $(this).find("input[name='prime_cost']").val();       //原价
				entity.collage_price = $(this).find("input[name='collage_price']").val(); //拼团价
				entity.opt=opt;
				specArray.push(entity);
			});
		}
	});
	
	var newIds=productIds.substring(0,productIds.length-1);
	params.product_ids=newIds;
	params.setItems=JSON.stringify(specArray);
 	$(".float-e-margins").mask("正在提交数据...");
 	$.post(obz.ctx+"/groupon/save", params, function(resp) {
		$(".float-e-margins").unmask();
		if(resp.code != 200){
			obz.error(resp.msg);
			return;
		}
		obz.msg("保存成功", function(){
			location.href = obz.ctx + "/groupon";
		});
	});   
}
$(document).ready(function(){
	bindSetTableAEvent();
});
function bindSetTableAEvent(){
	//注册取消返现商品事件
	$(".productSetLotGrid").find("tr a").each(function(){
		$(this).unbind("click");
		$(this).click(function(){
			var me = $(this);
			//取消设置不能直接删除该行，需要隐藏
			me.parent().parent().attr("opt", "del");
			me.parent().parent().hide();
			$("#checkbox_"+me.attr("id")).attr("checked", false);
//==========$("#checkbox_"+me.attr("id")).parent().parent().removeAttr("style");
			return false;
		});
	});
}

var params = {};
param.csrf_token = $("#CSRF_TOKEN_HIDDEN").val();
var table = new obz.TableView("pager", obz.ctx + "/groupon/listProducts", params, function(resp){
	$(".productLotGrid").empty();
	var dataList = resp.list;
	if(dataList.length>0){
		for(var i=0;i<dataList.length;i++){
			var _row = dataList[i];
			var trHtml = obz.dataTemplate4obj($("#product_table_tr_tpl").html(), _row);
			$(".productLotGrid").append(trHtml);
		}
		TBatch.checkCheckbox(function (chkAll){
			$("#_sel_total_item").html(parseInt(TBatch.getCheckedCount()) + parseInt($("#_sel_total_item").text()));
			$("#mainTable input:checkbox.commchk").each(function(){
				if($(this).is(":checked") == true){
					selectItem($(this));
				}else{
					unSelectItem($(this));
				}
			});
		});
		TBatch.initCheckboxClick(function(resp){
			selectItem($(resp));
		}, function(resp){
			unSelectItem($(resp));
		});
	}else{
		$(".productLotGrid").append($("#table_noresult_tr_tpl").html());
	}
});
table.init();

stepInfoNull={//没有规格
  Creat_Table: function (productPrice,productStock,productId,collage_price,groupSetId) {
	  $("#createTable_"+productId).html("");
      var table = $("<table id=\"process_"+productId+"\" class=\"table table-striped table-bordered\"></table>");
      table.appendTo($("#createTable_"+productId));
      var thead = $("<thead></thead>");
      thead.appendTo(table);
      var trHead = $("<tr></tr>");
      trHead.appendTo(thead);
      //创建表头
      var itemColumHead = $("<th  style=\"width:70px;\">原价（￥）</th><th  style=\"width:70px;\">拼团价（￥）</th><th style=\"width:70px;\">库存</th> ");
      itemColumHead.appendTo(trHead);
      var tbody = $("<tbody></tbody>");
      tbody.appendTo(table); 
      var tr = $("<tr></tr>");
      tr.appendTo(tbody);
      var td1 = $("<td class=\"col-md-2\"><span  class=\"requiredField\"></span><input  name=\"prime_cost\" class=\"form-control\" type=\"text\" value=\""+productPrice+"\" readonly=\"readonly\"></td>");
      td1.appendTo(tr);
      if(collage_price!=null){
          var td2 = $("<td class=\"col-md-2\"><input  name=\"groupSetId\" class=\"form-control\" type=\"hidden\" value=\""+groupSetId+"\"><input  name=\"collage_price\" class=\"form-control\" type=\"text\" value=\""+collage_price+"\"  onkeyup=\"num(this)\"><label class=\"stock_error_msg\" style=\"color:red;\"></td>");
          td2.appendTo(tr);   
      }else{
       var td2 = $("<td class=\"col-md-2\"><span class=\"requiredField\"></span><input  name=\"collage_price\" class=\"form-control\" type=\"text\" value=\"\"  onkeyup=\"num(this)\"><label class=\"stock_error_msg\" style=\"color:red;\"></td>");
       td2.appendTo(tr); 
      }
      var td3 = $("<td class=\"col-md-2\">"+productStock+"</td>");
      td3.appendTo(tr); 
  }
		  
}


step = {
        Creat_Table: function (info,infoId,title,productId,productSpec,groupSet) {
            step.hebingFunction();
            var arrayTile = new Array();//标题组数 : 颜色,尺码
            var arrayInfor = new Array();//盛放每组选中的CheckBox值的对象 : 白色,37,38,39
            var arrayInforId = new Array();//盛放每组选中的CheckBox id值的对象:  1,12,13,14
            var arrayColumn = new Array();//指定列，用来合并哪些列
            var bCheck = true;//是否有值
            var columnIndex = 0;
            var td_array_title = title.split(",");
            $.each(td_array_title, function (i, values) {
            	 arrayColumn.push(columnIndex);
            	 columnIndex++;
            	 arrayTile.push(values.replace("：", ""));
                 
            });
            var td_array_info = info.split(",");//值对象
            $.each(td_array_info, function (i, values) {
            	//alert(values);
            	 var order = new Array();
            	 var newstr=values.substring(0,values.length-1);
            	 var td_array_info1 = newstr.split(";");
            	 $.each(td_array_info1, function (j, value) {
            		 order.push(value); 
            	 });
            	 arrayInfor.push(order);
            });
            var td_array_infoId = infoId.split(",");//值Id对象
            $.each(td_array_infoId, function (i, values) {
            	var orderId = new Array();
            	var newstr=values.substring(0,values.length-1);
            	 var td_array_infoId1 = newstr.split(";");
            	 $.each(td_array_infoId1, function (j, value) {
            		 orderId.push(value); 
            	 });
            	  arrayInforId.push(orderId);
            });
            if (arrayInfor.length <=0){
                bCheck = false;
            }
            if (bCheck == true) {
            	var RowsCount = 0;
            //创建表
            $("#createTable_"+productId).html("");
            var table = $("<table id=\"spec_"+productId+"\" class=\"table table-striped table-bordered\"></table>");
            table.appendTo($("#createTable_"+productId));
            var thead = $("<thead></thead>");
            thead.appendTo(table);
            var trHead = $("<tr></tr>");
            trHead.appendTo(thead);
            //创建表头
            $.each(arrayTile, function (index, item) {
                var td = $("<th>" + item + "</th>");
                td.appendTo(trHead);
            });
            var itemColumHead = $("<th  style=\"width:90px;\">原价（￥）</th><th  style=\"width:90px;\">拼团价（￥）</th><th style=\"width:70px;\">库存</th> ");
            itemColumHead.appendTo(trHead);
            var tbody = $("<tbody></tbody>");
            tbody.appendTo(table);
            
            ////生成组合
            var zuheId=step.doExchange(arrayInforId);
            if (zuheId.length > 0) {
            	items.length=0;
            $.each(zuheId, function (index, item) {
                items.push(item);
            });
            }
            $("#spec_"+productId).attr("specItem",JSON.stringify(items));
            //alert(JSON.stringify(items));
            
            var zuheDate = step.doExchange(arrayInfor);
            var td_spec = productSpec.split(",");//规格
            var groupSetValue;
            if(groupSet!=null){
            	groupSetValue=groupSet.split(",");//拼团价
            }
            if (zuheDate.length > 0) {
            	 $.each(zuheDate, function (index, item) {
            		 var td_array = item.split(",");
                     var tr = $("<tr></tr>");
                     tr.appendTo(tbody);
                     $.each(td_array, function (i, values) {
                         var td = $("<td>" + values + "</td>");
                         td.appendTo(tr);
                     });
                     var td_spec_value=td_spec[index];
                     var spec_value=td_spec_value.split(";");
                     var td1 = $("<td class=\"col-md-2\"><span  class=\"requiredField\"></span><input  name=\"prime_cost\" class=\"form-control\" type=\"text\" value=\""+spec_value[0]+"\" readonly=\"readonly\"></td>");
                     td1.appendTo(tr);
                     if(groupSet!=null){
                    	 //alert(groupSetValue[index])
                    	 if(groupSetValue[index]){
                    		 var td_groupSet_value=groupSetValue[index].split(";");
    	                     var td2 = $("<td class=\"col-md-2\"><input  name=\"groupSetId\" class=\"form-control\" type=\"hidden\" value=\""+td_groupSet_value[0]+"\"><input  name=\"collage_price\" class=\"form-control\" type=\"text\" value=\""+td_groupSet_value[1]+"\"  onkeyup=\"num(this)\"><label class=\"collage_error_msg\" style=\"color:red;\"></td>");
    	                     td2.appendTo(tr); 
                    	 }else{
                    		 var td2 = $("<td class=\"col-md-2\"><span class=\"requiredField\"></span><input  name=\"collage_price\" class=\"form-control\" type=\"text\" value=\"\"  onkeyup=\"num(this)\"><label class=\"collage_error_msg\" style=\"color:red;\"></td>");
    	                     td2.appendTo(tr);
                    	 }
                     }else{
	                     var td2 = $("<td class=\"col-md-2\"><span class=\"requiredField\"></span><input  name=\"collage_price\" class=\"form-control\" type=\"text\" value=\"\"  onkeyup=\"num(this)\"><label class=\"collage_error_msg\" style=\"color:red;\"></td>");
	                     td2.appendTo(tr); 
                     }
                     var td3 = $("<td class=\"col-md-2\">"+spec_value[1]+"</td>");
                     td3.appendTo(tr); 
            	 });
            }
          //结束创建Table表
            arrayColumn.pop();//删除数组中最后一项
            //合并单元格
            $(table).mergeCell({
                // 目前只有cols这么一个配置项, 用数组表示列的索引,从0开始
                cols: arrayColumn
            });
            
            }else{
                document.getElementById('createTable_'+productId).innerHTML="";
            }
            
        },//合并行
        hebingFunction: function () {
            $.fn.mergeCell = function (options) {
                return this.each(function () {
                    var cols = options.cols;
                    for (var i = cols.length - 1; cols[i] != undefined; i--) {
                        // fixbug console调试
                        // console.debug(cols[i]);
                        mergeCell($(this), cols[i]);
                    }
                    dispose($(this));
                });
            };
            function mergeCell($table, colIndex) {
                $table.data('col-content', ''); // 存放单元格内容
                $table.data('col-rowspan', 1); // 存放计算的rowspan值 默认为1
                $table.data('col-td', $()); // 存放发现的第一个与前一行比较结果不同td(jQuery封装过的), 默认一个"空"的jquery对象
                $table.data('trNum', $('tbody tr', $table).length); // 要处理表格的总行数, 用于最后一行做特殊处理时进行判断之用
                // 进行"扫面"处理 关键是定位col-td, 和其对应的rowspan
                $('tbody tr', $table).each(function (index) {
                    // td:eq中的colIndex即列索引
                    var $td = $('td:eq(' + colIndex + ')', this);
                    // 取出单元格的当前内容
                    var currentContent = $td.html();
                    // 第一次时走此分支
                    if ($table.data('col-content') == '') {
                        $table.data('col-content', currentContent);
                        $table.data('col-td', $td);
                    } else {
                        // 上一行与当前行内容相同
                        if ($table.data('col-content') == currentContent) {
                            // 上一行与当前行内容相同则col-rowspan累加, 保存新值
                            var rowspan = $table.data('col-rowspan') + 1;
                            $table.data('col-rowspan', rowspan);
                            // 值得注意的是 如果用了$td.remove()就会对其他列的处理造成影响
                            $td.hide();
                            // 最后一行的情况比较特殊一点
                            // 比如最后2行 td中的内容是一样的, 那么到最后一行就应该把此时的col-td里保存的td设置rowspan
                            if (++index == $table.data('trNum'))
                                $table.data('col-td').attr('rowspan', $table.data('col-rowspan'));
                        } else { // 上一行与当前行内容不同
                            // col-rowspan默认为1, 如果统计出的col-rowspan没有变化, 不处理
                            if ($table.data('col-rowspan') != 1) {
                                $table.data('col-td').attr('rowspan', $table.data('col-rowspan'));
                            }
                            // 保存第一次出现不同内容的td, 和其内容, 重置col-rowspan
                            $table.data('col-td', $td);
                            $table.data('col-content', $td.html());
                            $table.data('col-rowspan', 1);
                        }
                    }
                });
            }
            // 同样是个private函数 清理内存之用
            function dispose($table) {
                $table.removeData();
            }
        },
        //组合数组
        doExchange: function (doubleArrays) {
            var len = doubleArrays.length;
            if (len >= 2) {
                var arr1 = doubleArrays[0];
                var arr2 = doubleArrays[1];
                var len1 = doubleArrays[0].length;
                var len2 = doubleArrays[1].length;
                var newlen = len1 * len2;
                var temp = new Array(newlen);
                var index = 0;
                for (var i = 0; i < len1; i++) {
                    for (var j = 0; j < len2; j++) {
                        temp[index] = arr1[i] + "," + arr2[j];
                        index++;
                    }
                }
                var newArray = new Array(len - 1);
                newArray[0] = temp;
                if (len > 2) {
                    var _count = 1;
                    for (var i = 2; i < len; i++) {
                        newArray[_count] = doubleArrays[i];
                        _count++;
                    }
                }
                return step.doExchange(newArray);
            }
            else {
                return doubleArrays[0];
            }
        }
    }

#if(groupResult.productDto?? !=null)
#for(product: groupResult.productDto)
var productId="#(product.id)";
var info = "#(product.arrayInfor)";
if(info!=''){	
	info=info.substring(1,info.length-1);
	var infoId ="#(product.arrayInforId)";
	infoId=infoId.substring(1,infoId.length-1);
	var title ="#(product.arrayTitle)";
	title=title.substring(1,title.length-1);
	var productSpec="#(product.arraySpec)";
	productSpec=productSpec.substring(1,productSpec.length-1);
	var groupSet="#(product.arrayGroupSet)";
	groupSet=groupSet.substring(1,groupSet.length-2);
	step.Creat_Table(info,infoId,title,productId,productSpec,groupSet);
}else{
	var groupSet="#(product.arrayGroupSet)";
	groupSet=groupSet.substring(1,groupSet.length-2);
	var collage_price=groupSet.split(";");
	stepInfoNull.Creat_Table("#(product.price)","#(product.stock)",productId,collage_price[1],collage_price[0]);
}
#end
#end	
</script>	
#end